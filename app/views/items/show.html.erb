<p id="notice"><%= notice %></p>
<% provide(:title, @item.unique_name) %>

<% if !@item.active? %>
  <div class="panel panel-danger">
    <div class="panel-heading">
      <h3 class="panel-title">Item has been deleted.</h3>
    </div>
  </div>
<% end %>

<% if @item.active? || is_manager_or_admin? %>

<div class="center_jumbotron">
  <h2 class="page-header"><%= @item.unique_name %>
    <% if is_manager_or_admin? && @item.active? %>
      <%= link_to "Edit Item", edit_item_url(@item.id), :class => "btn btn-primary pull-right" %>
    <% end %>
  </h2>
</div>

<ul class="nav nav-tabs">
  <li class="active"><a href="#home" data-toggle="tab">Item Details</a></li>
  <li><a href="#requests" data-toggle="tab"><%= (is_manager_or_admin?) ? "All Outstanding Requests" : "My Outstanding Requests" %></a></li>
  <li><a href="#loans" data-toggle="tab">Loans TBD</a></li>
</ul>

<div id="myTabContent" class="tab-content">
  <div class="tab-pane fade active in" id="home">
    <br>
    <div class="panel panel-primary">
      <div class="panel-heading">Main Details</div>
      <div class="panel-body">
      <!-- All Item Information: Quantity in Stock, Model Num, Description -->
        <p>
          <strong>In Stock</strong>
      	    <%= @item.quantity %> out of <%= @item.quantity_on_loan + @item.quantity %>
    	</p>
    	<p>
      	  <strong>Model Number</strong>
      	  <%= @item.model_number %>
    	</p>
    	<p>
     	  <strong>Description</strong>
    	  <%= @item.description %>
    	</p>
    	<p>
    	  <strong>Tags TBD</strong>
    	  <% @item.tags.each do |tag| %>
	    <%= tag.name + ', ' %>
    	  <% end %>
    	</p>
      </div>
    </div>

    <div class="col-lg-0.5"></div>

    <div class="panel panel-info">
      <div class="panel-heading">Additional Information</div>
      <div class="panel-body">
        <!-- Custom Fields -->
	<% @item_custom_fields.each do |icf| %>
	  <% field_content = ItemCustomField.field_content(@item.id, icf.custom_field_id) %>
	  <% if is_manager_or_admin? || !icf.custom_field.private_indicator %>
	    <p>
	      <strong><%= icf.custom_field.field_name %></strong> 	      
	      <% if !is_manager_or_admin? %>
		<%= field_content %>
	      <% else %>
		<a href="#" data-xeditable="true"
		   data-pk="<%= icf.id %>"
		   data-model="item_custom_field"
		   data-name="<%= CustomField.find_icf_field_column(icf.custom_field_id).to_s %>"
		   data-url="<%= item_custom_field_url(icf) %>"
		   data-title="enter modification">
		  <%= field_content %>
		</a>
	      <% end %>
	    </p>
	  <% else %>
	  <% end %>
	<% end %>
      </div>
    </div>

		<div class="pull-right">
			<table>
				<thead>
					<tr>
						<th class="text-center">Loan</th>
						<th class="text-center">Disbursement</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					<% ri = RequestItem.where(item_id: @item.id).where(request_id: grab_cart(current_user).id).take %>
					<% if ri.nil? %>
  					<%= render 'indexform', request_item: RequestItem.new(item_id: @item.id, 
							request_id: grab_cart(current_user).id) %>
  				<% else %>
						<%= render 'indexform', request_item: ri %>
					<% end %>
				</tbody>
			</table>
		</div><br><br>
  </div>


  <div class="tab-pane fade" id="requests">
    <br>
    <% if @item.deactive? %>
      <blockquote>
	-- These requests cannot be approved as is -- 
      </blockquote>
    <% end %>

    <%= render @requests %>
    <%= will_paginate @requests %>

  </div>

  <div class="tab-pane fade" id="loans">
    <br>

  </div>

</div>


<% end %>
